<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="quantum">
<head>
  <!-- [Previous head content remains exactly the same until the script section] -->
</head>
<body>
  <!-- [All your existing body content remains the same until the scripts] -->

  <!-- Three.js Script - SAFE VERSION -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // ===== SAFE THREE.JS INITIALIZATION =====
    function initQuantumVisualization() {
      try {
        const container = document.getElementById('quantum-ship-container');
        if (!container) return;
        
        // Only init on desktop
        if (window.innerWidth >= 768 && !navigator.userAgent.match(/Mobi|Android/i)) {
          if (typeof THREE === 'undefined') throw new Error("Three.js failed to load");
          
          const scene = new THREE.Scene();
          const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
          const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
          
          renderer.setSize(container.clientWidth, container.clientHeight);
          container.appendChild(renderer.domElement);
          
          // [Rest of your existing Three.js code...]
          
          animate();
        }
      } catch (e) {
        console.error("Quantum visualization error:", e);
        const container = document.getElementById('quantum-ship-container');
        if (container) container.style.display = 'none';
      }
    }

    // ===== FAILSAFE MANIFESTO ANIMATIONS =====
    function initManifestoAnimations() {
      const lines = document.querySelectorAll('.manifesto-line');
      
      // First make all lines visible as fallback
      lines.forEach(line => line.classList.add('visible'));
      
      // Only animate if IntersectionObserver is supported
      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            entry.target.classList.toggle('visible', entry.isIntersecting);
          });
        }, { threshold: 0.1 });

        // Reset lines to hidden before animating in
        lines.forEach(line => {
          line.classList.remove('visible');
          observer.observe(line);
        });
      }
    }

    // ===== SAFE DOCUMENT LOAD =====
    document.addEventListener('DOMContentLoaded', () => {
      initManifestoAnimations();
      initQuantumVisualization();
      
      // Handle resize safely
      window.addEventListener('resize', () => {
        const container = document.getElementById('quantum-ship-container');
        if (container && container.firstChild) {
          const renderer = container.firstChild;
          renderer.setSize(container.clientWidth, container.clientHeight);
        }
      });
    });
  </script>
</body>
</html>
